# 03C - Basic OAuth

In this challenge you will implement OAuth for a Flask webapp in preparation for deploying your image webapp to AWS. You will also explore some commonly used features in Flask such as sessions, templates, blueprints, and config.

**Disclaimer** - The use of OAuth here is rudimentary and is for illustrative purposes only. Proper authentication requires much more work.

## Parts

- Flask
- Requests
- OAuth 

## OAuth Code Flow and Github

Explanation of OAuth is delegated to the following:

[Auth0's Explanation](https://auth0.com/docs/flows/concepts/auth-code)

[An Illustrated Guide to OAuth and OpenID Connect](https://developer.okta.com/blog/2019/10/21/illustrated-guide-to-oauth-and-oidc#:~:text=OAuth%202.0%20is%20designed%20only,person%20who%20is%20logged%20in.)

Below you'll find documentation for the OAuth API:

[Github's API docs](https://docs.github.com/en/developers/apps/authorizing-oauth-apps)

For the purpose of this challenge, you will need to understand the steps for a user to authorize an app to use Github services through OAuth.

1. User initiates authorization and is redirected to Github.
2. User tells Github your app is authorized
3. User is redirected back to your app with a code
4. Your app backend uses the code to grab an authorization token

Now your backend can use the authorization token to call Github APIs!

## Challenge

In this challenge you are provided with a mostly complete web app. Using the existing code base for hints, implement the `/auth/login` and `/auth/authorized` endpoints in the auth Flask Blueprint. Once complete navigate to `localhost:5000/` to see it working.

Once your app is working, replace the FakeDatabase in `db.py` with an actual SQLite database.

### Setup

Before you start you'll need to create an OAuth App on Github to get your ClientID and ClientSecret. On Github go to Settings > Developer Settings > OAuth Apps and create a new application:

```
Application name: whatever you want
Homepage URL: http://localhost:5000
Authorization callback URL: http://localhost:5000/auth/authorized
```

Whenever you start your application you'll want to do so with environment variables like the following:

`GITHUB_CLIENT_ID=<your client id> GITHUB_CLIENT_SECRET=<your secret> SECRET_KEY=<any secret> FLASK_DEBUG=1 FLASK_APP=app.py flask run`


### Tips

You can see what `flask.session` does to your cookies by using the Chrome Developer Tool's Application Tab in the Cookies section. The value should be something like: `eyJnaXRodWJfaWQiOjEyMzY0MzYsInVzZXJfaWQiOiJmcmVlZm9vZDg5In0.XyE55A.gwYrpPyJoil8xp-uohogkP5-jxs`. Where the leading part (before the '.') is a base 64 encoded JSON and the trailing part (after the '.') is the signature, which is generated using your `SECRET_KEY`. The signature allows your backend to verify that the cookie originated from it and that it's not generated by a malicious user.

You can base64 decode using the following:

`echo <encoded string> | base64 --decode`